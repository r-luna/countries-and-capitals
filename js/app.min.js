var app=angular.module("app",["ngRoute","ngMessages","ngAnimate","ngTouch"]).constant("CONSTANTS",{version:"0.0.0"});app.config(["$routeProvider",function(t){t.when("/",{templateUrl:"templates/home.html",controller:"HomeController as home"}).when("/countries/",{templateUrl:"templates/countries.html",controller:"CountriesController as countries"}).when("/country/:country/:capital",{templateUrl:"templates/country.html",controller:"CountryController as country"}).when("/error/",{templateUrl:"/templates/error.html"}).otherwise("/")}]),app.factory("geonames",function(){return{data:null,insert:function(t){this.data=t}}}),app.run(["$rootScope","$location","$timeout",function(t,o,n){t.$on("$routeChangeError",function(){o.path("/error")}),t.$on("$routeChangeStart",function(){t.isLoading=!0}),t.$on("$routeChangeSuccess",function(){n(function(){t.isLoading=!1},700)})}]),app.controller("CountriesController",["$scope","$rootScope","$location","$http","geonames",function(t,o,n,e,a){function r(t){l.modalMessage=t,l.canShowModal=!0}function u(){o.isLoadingData=!0,e({url:"http://api.geonames.org/countryInfoJSON?username=eyepoker&_="+Math.random(),method:"GET",data:{callback:"JSON_CALLBACK"}}).then(function(t){200===t.status?(a.insert(t.data.geonames),l.data=a.data,console.log(l.data)):r(t.status,t.statusText),o.isLoadingData=!1},function(t,o,n,e){r(o)})}var l=this;this.data=null,this.canShowModal=!1,this.modalMessage="",this.home=function(){n.path("/")},this.hideModal=function(){l.canShowModal=!1,l.modalMessage=""},this.showCapitalDetail=function(t,o){if(!t||!o)return void r("Unable to find country information without a capital.");var e=t.replace(" ","_"),a=o.replace(" ","_");n.path("/country/"+e+"/"+a)},t.$on("$viewContentLoaded",function(t,o){a.data?l.data=a.data:u()})}]),app.controller("CountryController",["$scope","$routeParams","$location","$http","geonames",function(t,o,n,e,a){function r(t){e({url:"http://api.geonames.org/searchJSON?q="+t+"&maxrows=10&username=eyepoker&_="+Math.random(),method:"GET",data:{callback:"JSON_CALLBACK"}}).then(function(t){200===t.status?l.data=t.data.geonames[0]:console.log(t.status,t.statusText)},function(t,o,n,e){console.log("Failure :(")})}function u(t){for(var o=a.data||[],n=null,r=0;r<o.length;r++)if(o[r].countryName===t){console.log(o[r]),n=o[r].countryCode;break}return n?void e({url:"http://api.geonames.org/neighboursJSON?country="+n+"&username=eyepoker&_="+Math.random(),method:"GET",data:{callback:"JSON_CALLBACK"}}).then(function(t){200===t.status?(l.neighbours=t.data.geonames||[],console.log(t.data.geonames)):console.log(t.status,t.statusText)},function(t,o,n,e){console.log(o,n)}):void(l.error="Couldn't determine the geonameId from the city name")}var l=this;this.data=null,this.neighbours=[],this.error=null,t.$on("$viewContentLoaded",function(t,e){return a.data?(r(escape(o.capital.replace("_"," "))),void u(escape(o.country.replace("_"," ")))):void n.path("/")}),this.home=function(){n.path("/")},this.back=function(){n.path("/countries")},this.showCountry=function(t){l.neighbours=[],l.error=null;for(var o=a.data||[],t=t.replace("_"," "),e=null,r=0;r<o.length;r++)o[r].countryName===t&&(e=o[r].capital.replace(" ","_"));n.path("/country/"+t+"/"+e)},this.returnCountryPopulation=function(){for(var t=a.data||[],n=o.country.replace("_"," "),e=0;e<t.length;e++)if(t[e].countryName===n)return t[e].population},this.returnFlagURI=function(){for(var t=a.data||[],n=o.country.replace("_"," "),e=null,r=0;r<t.length;r++)t[r].countryName===n&&(e=t[r].countryCode.toLowerCase());return"http://www.geonames.org/flags/x/"+e+".gif"},this.returnCountryURI=function(){for(var t=a.data||[],n=o.country.replace("_"," "),e=null,r=0;r<t.length;r++)t[r].countryName===n&&(e=t[r].countryCode);return"http://www.geonames.org/img/country/250/"+e+".png"}}]),app.controller("HomeController",["$scope","$location",function(t,o){this.start=function(){o.path("/countries")}}]);